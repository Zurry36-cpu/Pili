<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Loja - 100% Funcional</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        /* [Manter os estilos existentes] */
        .admin-only { display: none; }
        .logged-in .admin-only { display: block; }
    </style>
</head>
<body>
    <!-- [Manter toda a estrutura HTML existente] -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sistema 100% funcional com localStorage como banco de dados temporário
        const DB = {
            products: JSON.parse(localStorage.getItem('products')) || [
                { id: 1, name: "Smartphone XYZ", price: 1999.90, image: "https://via.placeholder.com/300?text=Smartphone", stock: 10 },
                { id: 2, name: "Notebook Ultra", price: 4599.00, image: "https://via.placeholder.com/300?text=Notebook", stock: 5 }
            ],
            users: [
                { id: 1, email: 'admin@example.com', password: 'admin123', isAdmin: true }
            ],
            orders: JSON.parse(localStorage.getItem('orders')) || []
        };

        // Estado da aplicação
        let currentUser = null;
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        // Funções do sistema
        function saveToDB() {
            localStorage.setItem('products', JSON.stringify(DB.products));
            localStorage.setItem('orders', JSON.stringify(DB.orders));
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        function renderAdminProducts() {
            const container = document.getElementById('adminProductsContainer');
            if (!container) return;
            
            container.innerHTML = DB.products.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td><img src="${product.image}" width="50"></td>
                    <td>${product.name}</td>
                    <td>R$ ${product.price.toFixed(2)}</td>
                    <td>${product.stock}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-product" data-id="${product.id}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-product" data-id="${product.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
            
            // Adicionar eventos
            document.querySelectorAll('.edit-product').forEach(btn => {
                btn.addEventListener('click', () => editProduct(parseInt(btn.dataset.id)));
            });
            
            document.querySelectorAll('.delete-product').forEach(btn => {
                btn.addEventListener('click', () => deleteProduct(parseInt(btn.dataset.id)));
            });
        }

        function editProduct(id) {
            const product = DB.products.find(p => p.id === id);
            if (!product) return;
            
            document.getElementById('editProductId').value = product.id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductStock').value = product.stock;
            document.getElementById('editProductImage').value = product.image;
            
            new bootstrap.Modal(document.getElementById('editProductModal')).show();
        }

        function saveProduct() {
            const id = parseInt(document.getElementById('editProductId').value);
            const name = document.getElementById('editProductName').value;
            const price = parseFloat(document.getElementById('editProductPrice').value);
            const stock = parseInt(document.getElementById('editProductStock').value);
            const image = document.getElementById('editProductImage').value;
            
            if (id === 0) {
                // Novo produto
                const newId = DB.products.length > 0 ? Math.max(...DB.products.map(p => p.id)) + 1 : 1;
                DB.products.push({ id: newId, name, price, stock, image });
            } else {
                // Editar existente
                const index = DB.products.findIndex(p => p.id === id);
                if (index >= 0) {
                    DB.products[index] = { ...DB.products[index], name, price, stock, image };
                }
            }
            
            saveToDB();
            renderAdminProducts();
            renderProducts();
            bootstrap.Modal.getInstance(document.getElementById('editProductModal')).hide();
        }

        function deleteProduct(id) {
            if (confirm('Tem certeza que deseja excluir este produto?')) {
                DB.products = DB.products.filter(p => p.id !== id);
                saveToDB();
                renderAdminProducts();
                renderProducts();
            }
        }

        function addNewProduct() {
            document.getElementById('editProductForm').reset();
            document.getElementById('editProductId').value = 0;
            new bootstrap.Modal(document.getElementById('editProductModal')).show();
        }

        // [Manter todas as outras funções existentes como renderProducts, addToCart, etc]
        // Modificar a função de login:
        function handleLogin(email, password) {
            const user = DB.users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                document.body.classList.add('logged-in');
                
                if (user.isAdmin) {
                    document.getElementById('homePage').style.display = 'none';
                    document.getElementById('dashboardContent').style.display = 'block';
                    renderAdminProducts();
                    renderAdminOrders();
                } else {
                    // Usuário normal
                    alert('Login realizado com sucesso!');
                }
                return true;
            }
            return false;
        }

        // Adicionar no DOMContentLoaded:
        document.addEventListener('DOMContentLoaded', function() {
            // [Manter todos os event listeners existentes]
            
            // Novo: Admin Product Form
            document.getElementById('editProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveProduct();
            });
            
            // Novo: Botão adicionar produto
            document.getElementById('addProductBtn').addEventListener('click', addNewProduct);
        });

        // Adicionar esta seção no dashboardContent no HTML:
        /*
        <div class="card mt-4">
            <div class="card-header d-flex justify-content-between">
                <h5 class="mb-0">Produtos</h5>
                <button class="btn btn-primary btn-sm" id="addProductBtn">
                    <i class="bi bi-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Imagem</th>
                                <th>Nome</th>
                                <th>Preço</th>
                                <th>Estoque</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="adminProductsContainer">
                            <!-- Produtos serão inseridos aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        */

        // Adicionar este modal antes do </body>:
        /*
        <div class="modal fade" id="editProductModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Editar Produto</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="editProductForm">
                            <input type="hidden" id="editProductId" value="0">
                            <div class="mb-3">
                                <label class="form-label">Nome</label>
                                <input type="text" class="form-control" id="editProductName" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Preço</label>
                                <input type="number" step="0.01" class="form-control" id="editProductPrice" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Estoque</label>
                                <input type="number" class="form-control" id="editProductStock" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">URL da Imagem</label>
                                <input type="url" class="form-control" id="editProductImage" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Salvar</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        */
    </script>
</body>
</html>
